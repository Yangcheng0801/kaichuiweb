# API基础URL（前端 Vite 使用）
VITE_API_BASE_URL=/api

# ---------- 本地后端开发（server）-----------
# 云托管部署时在控制台配置环境变量，无需改本文件
# 本地开发必须用 3000，和 vite 的 proxy 一致；部署时由平台指定端口（如 80）
# PORT=3000
# TCB_ENV_ID=cloud1-6g9w3840a91ca042
# WX_WEB_APPID=wx6209c37b949b2a79
# WX_WEB_SECRET=b7b09af86c3c688941727141ff05f3af
# JWT_SECRET=7ULTRqqb/h5CjXEO4X/effuIwDqjHNNMAid8fAMYQIoPqiQUE4oBBVYWhliF3y2y
# USE_HTTP_DB= true
# WX_APPID=wx2766aa326108bfa2
# WX_APP_SECRET=8f8ca4917e39c75b70019fba68b9b0e2


#  // ---------- 布局状态 ----------
#   const [activeMenu, setActiveMenu] = useState<MenuKey>('dashboard')
#   const [sidebarOpen, setSidebarOpen] = useState(false)   // 桌面端：鼠标靠近左边缘展开
#   const [drawerOpen, setDrawerOpen] = useState(false)     // 移动端：抽屉开关
#   const [dualViewOpen, setDualViewOpen] = useState(false) // 双视图模式
#   const [secondaryView, setSecondaryView] = useState<MenuKey>('users')
#   const [splitRatio, setSplitRatio] = useState(50)         // 左右分栏比例 0-100，默认 5:5

#   // ---------- 放置模式（类似 Windows 小窗） ----------
#   const [placementMode, setPlacementMode] = useState<{ module: MenuKey; currentActive: MenuKey } | null>(null)
#   const [placementHoverZone, setPlacementHoverZone] = useState<'left' | 'right' | null>(null)
#   const placementContainerRef = useRef<HTMLDivElement>(null)
#   const placementHoverZoneRef = useRef<'left' | 'right'>('right')

#   // ---------- 长按与分割线拖拽 ----------
#   const longPressTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)
#   const longPressFiredRef = useRef(false)
#   const splitContainerRef = useRef<HTMLDivElement>(null)
#   const splitDraggingRef = useRef(false)
#   const [isDraggingSplit, setIsDraggingSplit] = useState(false) // 拖拽分割线时禁用 width 过渡，避免延迟


# 第一梯队：成熟 ERP 必备（目前完全缺失）
# 1. 报表与数据分析模块 — 目前最大的空白
# 这是任何 ERP 系统最核心的能力之一。当前系统只有仪表盘简单 KPI 和餐饮日报，缺乏完整的经营分析体系：
# 营收报表：日/周/月/季/年维度，按收入类型分解（果岭费/球车/球童/客房/餐饮/零售/其他）
# 预订分析：利用率热力图（时段 × 球场）、取消率、No-Show 率、平均提前预订天数
# 球员分析：活跃度分布、消费频次、ARPU（人均收入）、流失预警、新会员增长曲线
# 资源利用率：球车周转率、球童工时统计、更衣柜使用率、客房入住率（RevPAR）
# 财务报表：收款方式分布、应收/实收对账、日结/月结汇总
# 导出功能：Excel / PDF 导出
# 自定义日期范围 + 同比/环比对比
# 2. 权限管理 / RBAC（基于角色的访问控制）
# 当前系统仅 JWT 验证身份，没有权限体系。行业标准 ERP 必须有：
# 角色管理：总经理 / 前台主管 / 前台接待 / 球童主管 / 餐饮经理 / 财务 / 系统管理员
# 权限矩阵：每个角色对每个模块的 查看/创建/编辑/删除 四级权限
# 数据隔离：财务数据仅财务角色可见，会员余额仅授权角色可操作
# 操作审计日志：谁在什么时间做了什么操作（关键操作如退款、冲销、改价、充值等）
# 3. 日结/夜审（End of Day / Night Audit）
# 高尔夫 ERP 的核心财务流程：
# 日结操作：交班时汇总当班收款（现金/刷卡/微信/支付宝 分别核对）
# 夜审报告：自动检查未结账 Folio、异常消费、挂账超期
# 收银台对账：实收 vs 应收差异检查
# 自动关闭：当日未签到预订自动标记 No-Show
# 日结报表打印：PDF 格式的当日经营日报
# 4. 会员计划/权益体系
# 当前仅有会员等级和余额，缺乏完整的会籍管理：
# 会籍套餐：年度会籍 / 季度会籍 / 公司会籍（含多少轮次、权益描述、价格）
# 权益配置：每种会籍可享受什么（优先订场、折扣比例、免费球车次数、赠送餐饮券等）
# 会籍生命周期：开卡 → 生效 → 续费提醒 → 到期 → 续费/注销
# 积分体系：消费积分累积、积分兑换规则、积分商城
# 推荐奖励：老会员推荐新会员的追踪与奖励
# 第二梯队：行业特色功能（差异化竞争力）
# 5. 赛事/活动管理模块
# 高尔夫球场的重要运营场景：
# 赛事创建：比洞赛/比杆赛/四人最佳球/混合赛等赛制
# 编组抽签：Shotgun Start（散枪式出发）/ 标准分组
# 报名管理：在线报名、名额限制、报名费收取
# 实时记分：逐洞记分、实时排行榜
# 成绩公告：自动计算 Net/Gross 成绩、名次、奖金
# 6. 库存 / 专卖店（Pro Shop）
# 球场的重要收入来源：
# 商品管理：球杆/球包/服装/配件 等品类管理
# 库存进销存：入库/出库/盘点/库存预警
# 零售 POS：与 Folio 挂账体系打通
# 供应商管理：采购订单、供应商档案
# 7. 通知/消息系统
# 预订提醒：预订前一天/前两小时自动提醒（微信模板消息/短信）
# 到期提醒：会籍到期、更衣柜合同到期、充值余额不足
# 系统通知：维修工单完成、赛事报名通知
# 站内消息中心：管理后台内的消息收件箱
# 8. 员工排班与考勤
# 球童排班：早班/晚班/轮休，自动均衡派工
# 考勤打卡：上班/下班记录
# 绩效统计：球童服务场次、评分、提成计算
# 假期管理：请假/调休/加班记录
# 第三梯队：高级增值功能
# 9. CRM（客户关系管理）
# 客户分层画像（RFM 模型：最近消费/消费频率/消费金额）
# 生日/纪念日自动关怀
# 投诉/建议管理与跟进
# 营销活动管理（优惠券发放、满减活动）
# 10. 练习场管理
# 打位管理（Bay Management）
# 时段预订
# 练习球分发/计费
# 教练课程预约
# 11. 数据导入/导出
# 批量导入会员数据（Excel）
# 价格规则批量导入
# 全量数据导出/备份
# 报表 PDF/Excel 下载
# 12. 系统运维
# 操作日志查询界面
# 系统健康监控面板
# 数据库连接状态
# 错误日志查看




# 方案 A：4G DTU + GPS
# 硬件选型
# 核心设备：4G Cat-1 DTU（带 GPS 版）
# 型号	厂家	参考价	关键特性
# USR-G780s	有人物联	~280 元	Cat-1, 内置 GPS/GNSS, RS485, MQTT, 9-36V 宽压, EMC 4级, 出厂 eSIM 8 年免费流量(100M/月)
# EC200A-CN	移远 + 合宙	~150 元(模组)	Cat-1, 需自行设计载板, 适合量产降本
# WG232/WG285	塔石	~220 元	Cat-1, GPS, MQTT/TCP, 工业级
# 推荐入门方案：USR-G780s（开箱即用，内置 eSIM 免月租）
# 系统架构
# ┌──────────────────┐│   球车 (每台)      ││                  ││  ┌─────────────┐ │     4G LTE Cat-1│  │ 4G DTU      │─┼──────────────────┐│  │ + GPS天线   │ │                  ││  │ + 车载供电   │ │                  ▼│  └─────────────┘ │          ┌──────────────┐│  DC 12V/36V      │          │  MQTT Broker  ││  (球车电瓶取电)    │          │  (EMQX/阿里云)│└──────────────────┘          └──────┬───────┘                                     │                                     ▼                              ┌──────────────┐                              │  ERP 后端     │                              │  (Node.js)   │                              │  WebSocket → │──→ 前端地图                              │  数据库写入  │                              └──────────────┘
# 数据上报协议
# DTU 通过 MQTT 定时上报 JSON 格式的位置数据：
# {  "deviceId": "CART_A01",  "lat": 22.631234,  "lng": 114.055678,  "speed": 12.5,  "heading": 180,  "altitude": 45.2,  "satellites": 9,  "voltage": 48.2,  "timestamp": 1739404800000}
# 上报策略：
# 行驶中：每 5 秒 上报一次（100M/月流量完全够用）
# 静止时：每 60 秒 上报一次（节省流量）
# 关键事件（开机/熄火/超速/进入围栏）：立即上报
# 流量测算
# 场景	包大小	频率	每天运行	日流量	月流量
# 行驶 5s/次	~200B	720次/h	6h	864KB	~26MB
# 静止 60s/次	~200B	60次/h	4h	48KB	~1.4MB
# 合计			10h	~912KB	~28MB
# 100M/月的免费 eSIM 绑绑有余，无需额外 SIM 卡费。
# 部署步骤
# DTU 安装在球车座椅下方（防水盒），GPS 天线贴车顶
# 从球车 36V/48V 电瓶取电，经降压模块输出 12V 给 DTU
# DTU 配置 MQTT 服务器地址（ERP 后端或阿里云 IoT）
# 后端接收 MQTT 消息，写入 cart_locations 集合 + 推 WebSocket 到前端
# 方案 B：LoRa + GPS
# 硬件选型
# 车载端：LoRa GPS Tracker
# 型号	厂家	参考价	关键特性
# RAK10700	RAKwireless	~350 元	LoRaWAN, u-blox GNSS, 加速度计, 低功耗, 全球频段
# LGT-92	Dragino	~280 元	LoRaWAN GPS, 9轴传感器, IP67, 充电电池, 磁吸安装
# SenseCAP T1000	Seeed	~200 元	LoRaWAN, GPS/BDS, 超小卡片大小, IP65, 续航数月
# 自研(SX1262+L76K)	模组方案	~80 元	LoRa模组+GPS模组, 需自设计PCB, 量产最低成本
# 基站端：LoRaWAN Gateway
# 型号	厂家	参考价	关键特性
# RAK7268V2	RAKwireless	~1,500 元	室内/半室外, 8通道, 覆盖 2-5km
# RAK7289V2	RAKwireless	~3,000 元	室外 IP67, 8 通道, 覆盖 5-10km, 太阳能可选
# LPS8v2	Dragino	~800 元	室内, 8 通道, 性价比之选
# SX1302 DIY	自研	~400 元	树莓派 + SX1302 集中器, 极客方案
# 系统架构
# ┌──────────────────┐                              ┌──────────────────┐│  球车 A (Tracker) │──┐                           │  球车 N (Tracker) │──┐└──────────────────┘  │   LoRa 无线 (470MHz)       └──────────────────┘  │                      │   空旷 3-8km                                     │                      ▼                                                  ▼              ┌───────────────────────────────────────────────────────────────┐              │              LoRaWAN Gateway (会所楼顶)                        │              │   RAK7289 室外网关, 全向天线, 太阳能/市电                       │              └───────────────────────┬───────────────────────────────────────┘                                      │  有线网络 / 4G 回传                                      ▼                              ┌──────────────────┐                              │  LoRa Server      │                              │  (ChirpStack 自建  │                              │   或 TTN 公网)     │                              └──────┬───────────┘                                     │ HTTP/MQTT                                     ▼                              ┌──────────────────┐                              │  ERP 后端         │                              │  (Node.js)        │                              └──────────────────┘
# 覆盖规划
# 一个标准 18 洞球场面积约 50-80 公顷（长约 2-3km），理论上：
# 网关位置	数量	覆盖效果
# 会所楼顶 (15-20m高)	1 个	覆盖 70-80% 球道，远端洞可能盲区
# 会所楼顶 + 球道中段高点	2 个	覆盖 95%+，推荐方案
# 3 点部署（首尾+中段）	3 个	100% 覆盖，有冗余
# 关键：天线高度决定一切。 会所楼顶架设全向玻璃钢天线（增益 8dBi）可显著提升覆盖。
# 数据上报
# LoRaWAN 带宽有限（每次最大 ~240 字节），但 GPS 坐标数据很小：
# // LoRaWAN payload (紧凑二进制, 仅 14 字节)DeviceID(2B) + Lat(4B) + Lng(4B) + Speed(1B) + Battery(1B) + Satellites(1B) + Status(1B)
# 上报间隔：
# 行驶中：每 10-15 秒 一次（LoRaWAN 有 duty cycle 限制，CN470 较宽松）
# 静止：每 5 分钟 一次
# 这个间隔对球车管理完全够用（球车时速通常 15-25km/h）
# 深度对比
# 维度	4G DTU + GPS	LoRa + GPS
# 定位精度	2-5m (GNSS)	2-5m (GNSS)，同级
# 上报延迟	<1秒（实时）	1-3秒（LoRaWAN Class A）
# 上报间隔	可达 1-5秒	建议 10-15秒（duty cycle）
# 供电方式	必须从车载电瓶取电 (9-36V)	可内置电池（续航数月）或车载取电
# 网络依赖	依赖运营商 4G 信号	自建局域网，无外部依赖
# 信号死角	山谷/地下可能无信号	自控网关位置，可针对性覆盖
# 月运营费	免费 eSIM 或 ~10元/月 SIM卡	零月费
# 单车硬件成本	280-400 元	200-350 元 (Tracker)
# 基础设施成本	0 元（无需基站）	1,500-6,000 元（1-2 个网关）
# 30台车总成本	~9,000 元	~8,500-13,000 元
# 50台车总成本	~15,000 元	~12,500-19,000 元
# 部署复杂度	低（插卡即用）	中（需规划网关位置、测试覆盖）
# 运维复杂度	低（运营商维护网络）	中（网关需维护、固件升级）
# 扩展性	无限（加 SIM 卡即可）	单网关约 500 节点上限
# 数据安全	走公网，需 TLS 加密	私有局域网，天然隔离
# 抗干扰	运营商频段，干扰少	ISM 免许可频段，极端场景可能干扰
# 远程控车	可通过 DTU 下行指令控制	LoRaWAN Class C 可下行，但延迟高
# 我的建议
# 球场只需要定位调度 → 选 LoRa + GPS
# 零月租，长期运营成本最低
# 球场是封闭区域，自建网关完全可控
# 10-15 秒定位间隔对球车调度绰绰有余
# 推荐方案：2 个 RAK7289 室外网关 + Dragino LGT-92 或 SenseCAP T1000 Tracker
# 总预算（30 台车）：~12,000 元一次性投入，后续零费用
# 球场需要实时追踪 + 未来可能远程控车 → 选 4G DTU
# 秒级定位更精确实时
# DTU 支持双向通信，未来可扩展远程锁车/限速
# 无需自建基础设施，部署最快
# 推荐方案：USR-G780s（自带 eSIM 免月费）
# 总预算（30 台车）：~9,000 元，8 年免 SIM 卡费
# 混合方案（高性价比折中）
# 球道区域用 LoRa（覆盖广、免月费），会所/停车场区域用 4G DTU（需要即时控车/精确管理），两套数据统一汇入 ERP 后端的同一个 cart_locations 接口。




# 要不要我现在就在 ERP 系统里预留球车定位的数据模型和接口？只需要加一个 cart_locations 集合 + WebSocket 推送 + 前端地图组件的骨架，这样将来对接任何硬件方案都能即插即用。



# 系统已经是一个功能非常完整的高尔夫球会 ERP了。接下来的方向建议分三类：
# 一、巩固型（推荐优先）
# 这类工作不增加新功能，但对上线运营至关重要：
# 1. Docker 构建验证 + TypeScript 类型健全
# 上次 Docker build 有 TS 报错，修复后未验证成功
# 建议跑一次完整 npm run build，排除所有编译问题
# 收益：确保系统可部署
# 2. 首页仪表盘升级
# 当前首页 KPI 只有4项，但后端已有丰富数据（CRM洞察/会籍统计/RFM分布/营收报表）
# 建议整合为运营驾驶舱：实时营收曲线、今日签到率、客户健康度（RFM）、会籍到期预警、待处理跟进任务
# 收益：管理层打开系统首页就能掌握全局
# 3. 数据库索引优化
# 40+ 集合、大量 where + orderBy 查询，TCB NoSQL 没有索引时性能会快速退化
# 梳理高频查询路径，补齐复合索引
# 收益：防止上线后数据量增长时变慢
# 二、业务闭环型（价值最大）
# 4. 小程序端（球员自助服务） -- 强烈推荐
# 目前所有操作只能通过后台管理系统，球员无法自助
# 核心功能：
# 自助预订（选场/选时段/选球童）
# 我的预订（查看/取消/修改）
# 消费记录查询 + 余额/积分查看
# 会籍权益查看
# 接收通知（预订确认/提醒/营销推送）
# 收益：这是整个系统的用户端入口，没有它 CRM 营销活动无法触达客户、预订需人工电话接单
# 5. 数据批量导入/导出
# 球会迁移新系统时需要导入历史球员、会籍、消费数据
# Excel/CSV 导入球员名单、批量开卡
# 收益：解决系统冷启动问题，降低球会上线门槛
# 三、差异化增值型（锦上添花）
# 6. 练习场管理
# 打位预订/发球机对接/练习卡消费
# 适合有练习场的球会
# 7. 系统运维面板
# API 调用日志/错误日志/慢查询监控/数据库健康检查
# 适合多租户 SaaS 运营
# 8. 微信消息通道对接
# 将通知系统与微信模板消息/订阅消息打通
# CRM 营销活动真正能发送到客户手机
# 我的优先级建议
# P0（上线前必须）：Docker 构建验证 → 首页仪表盘升级P1（核心价值）  ：小程序端球员自助服务P2（运营支撑）  ：数据批量导入/导出 → 微信消息对接P3（增值扩展）  ：练习场管理 → 运维面板